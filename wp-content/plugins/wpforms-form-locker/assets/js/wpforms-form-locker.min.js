"use strict";var WPFormsFormLocker=window.WPFormsFormLocker||function(m){var f={init:function(){m(f.ready)},ready:function(){f.validation(),f.initNameGroupsValidation()},validation:function(){void 0!==m.fn.validate&&m.validator.addMethod("unique",function(s,n,e,r){if(this.optional(n))return"dependency-mismatch";r="string"==typeof r&&r||"unique";var o,t=m(n),d=t.closest(".wpforms-field"),u=this.previousValue(n,r),a={action:"wpforms_form_locker_unique_answer",form_id:t.closest(".wpforms-form").data("formid"),field_id:d.data("field-id")},t=n.name;return d.hasClass("wpforms-field-name")&&(s=f.getCombinedValue(d),t="wpforms[fields]["+a.field_id+"]"),a[t]=s,this.settings.messages[n.name]||(this.settings.messages[n.name]={}),u.originalMessage=u.originalMessage||this.settings.messages[n.name][r],this.settings.messages[n.name][r]=u.message,t=m.param(m.extend({data:s},(e="string"==typeof e?{url:e}:e).data)),u.old===t?u.valid:(u.old=t,(o=this).startRequest(n),m.ajax(m.extend(!0,{url:wpforms_form_locker.ajaxurl,type:"post",mode:"abort",port:"validate"+n.name,dataType:"json",data:a,context:o.currentForm,success:function(e){var t,a=!0===e||"true"===e,i=n.name.replace(/(\[[a-z]*\])$/g,"");o.settings.messages[n.name][r]=u.originalMessage,a?(t=o.formSubmitted,o.resetInternals(),o.toHide=o.errorsFor(n),o.formSubmitted=t,(o=f.updateValidatorLists(o,i,d,a)).showErrors()):(t={},e=e||o.defaultMessage(n,{method:r,parameters:s}),t[n.name]=u.message=e,(o=f.updateValidatorLists(o,i,d,a)).showErrors(t)),u.valid=a,o.stopRequest(n,a)}},e)),"pending")},wpforms_settings.val_unique)},initNameGroupsValidation:function(){m(".wpforms-validate").each(function(){var e=m(this),t=e.data("validator");m.extend(t.groups,f.getNameGroups(e))})},getCombinedValue:function(e){var t=[];return e.find("input[data-rule-unique]").each(function(){var e=m(this).val();wpforms.empty(e)||t.push(e)}),t.join(" ")},getNameGroups:function(e){var s={};return e.find(".wpforms-field.wpforms-field-name.wpforms-field-unique").each(function(e){var a=m(this),i=a.attr("id").replace("-container","")+"-field-group";m.each(["first","middle","last"],function(e,t){t=a.find(".wpforms-field-name-"+t).attr("name")||!1;t&&(s[t]=i)})}),s},updateValidatorLists:function(t,a,i,s){return m.each(t.invalid,function(e){e.indexOf(a)<0||(t.invalid[e]=!s,e=i.find('input[name="'+e+'"]'),s&&t.successList.push(e[0]))}),t}};return f}((document,window,jQuery));WPFormsFormLocker.init();