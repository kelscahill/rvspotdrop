"use strict";var WPFormsStripeElements=window.WPFormsStripeElements||function(e,i){var o={stripe:null,init:function(){o.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale}),i(e).on("wpformsReady",function(){i(".wpforms-stripe form").each(o.setupStripeForm)})},setupStripeForm:function(){var e=i(this);o.updateFormSubmitHandler(e),e.on("wpformsAjaxSubmitActionRequired",o.handleCardActionCallback)},setupCardElement:function(t,i){var n=t.find(".wpforms-stripe-credit-card-hidden-input"),e={classes:wpforms_stripe.data.element_classes,hidePostalCode:!0,style:{base:{fontFamily:n.css("font-family"),fontSize:n.css("font-size"),color:n.css("color")}}},e=o.stripe.elements().create("card",e);return e.mount(t.find(".wpforms-field-stripe-credit-card-cardnumber").get(0)),e.on("change",function(e){var r;e.error?(r=e.error.message,"incomplete_number"!==e.error.code&&"invalid_number"!==e.error.code||(r=wpforms_settings.val_creditcard),o.displayStripeError(t,r)):i.hideThese(i.errorsFor(n.get(0)))}),e},updateFormSubmitHandler:function(n){var e=n.validate(),a=e.settings.submitHandler,s=o.setupCardElement(n,e),d=n.find(".wpforms-field-stripe-credit-card-cardnumber");e.settings.submitHandler=function(){var e=n.validate().form(),r=d.hasClass(wpforms_stripe.data.element_classes.empty),t=d.data("required"),i=d.closest(".wpforms-field-stripe-credit-card").hasClass("wpforms-conditional-hide");if(e&&(i?!1:t||!r&&!t))n.find(".wpforms-submit").prop("disabled",!0),o.createPaymentMethod(n,s,t,a);else{if(e)return n.find(".wpforms-submit").prop("disabled",!1),a(n);n.find(".wpforms-submit").prop("disabled",!1),n.validate().cancelSubmit=!0}}},createPaymentMethod:function(r,e,t,i){o.stripe.createPaymentMethod("card",e,{billing_details:{name:r.find(".wpforms-field-stripe-credit-card-cardname").val()}}).then(function(e){return e.error&&t?(r.find(".wpforms-submit").prop("disabled",!1),o.displayStripeError(r,e.error.message),void(r.validate().cancelSubmit=!0)):(e.error||(r.find(".wpforms-stripe-payment-method-id").remove(),e.paymentMethod&&r.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+e.paymentMethod.id+'">')),void i(r))})},handleCardActionCallback:function(e,r){var t=i(this);r.success&&r.data.action_required&&o.stripe.handleCardPayment(r.data.payment_intent_client_secret).then(function(e){o.handleCardPaymentCallback(t,e)})},handleCardPaymentCallback:function(e,r){r.error?(o.formAjaxUnblock(e),e.find(".wpforms-field-stripe-credit-card-cardnumber").addClass(wpforms_stripe.data.element_classes.invalid),o.displayStripeError(e,r.error.message)):r.paymentIntent&&"succeeded"===r.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+r.paymentIntent.id+'">'),wpforms.formSubmitAjax(e)):o.formAjaxUnblock(e)},displayStripeError:function(e,r){var t={};t[e.find(".wpforms-stripe-credit-card-hidden-input").attr("name")]=r,wpforms.displayFormAjaxFieldErrors(e,t)},formAjaxUnblock:function(e){var r=e.closest(".wpforms-container"),t=e.find(".wpforms-submit-spinner"),i=e.find(".wpforms-submit"),e=i.data("submit-text");e&&i.text(e),i.prop("disabled",!1),r.css("opacity",""),t.hide()}};return o}(document,(window,jQuery));WPFormsStripeElements.init();