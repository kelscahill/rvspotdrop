"use strict";var WPFormsGeolocationGooglePlacesAPI=window.WPFormsGeolocationGooglePlacesAPI||function(a,t){var n,l=[],o={},s={init:function(){s.getFields(),l.length&&(s.initGeocoder(),l.forEach(function(e){s.initMap(e),s.initAutocomplete(e)}),s.detectGeolocation())},showDebugMessage:function(e){t.location.hash&&"#wpformsdebug"===t.location.hash&&console.log(e)},closest:function(e,t){for(var o=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e&&!o.call(e,t);)e=e.parentElement;return e},getFields:function(){Array.prototype.slice.call(a.querySelectorAll('.wpforms-form .wpforms-field input[type="text"][data-autocomplete="1"]')).forEach(function(e){var t,o=s.closest(e,".wpforms-field"),a=e.hasAttribute("data-display-map")?o.querySelector(".wpforms-geolocation-map"):null,n=o.classList[1]?o.classList[1].replace("wpforms-field-",""):"text",i={};"address"===n&&(t=o.querySelector(".wpforms-field-address-country"),i={locality:{el:o.querySelector(".wpforms-field-address-city"),type:"long_name"},political:{el:o.querySelector(".wpforms-field-address-state"),type:t?"long_name":"short_name"},administrative_area_level_1:{el:o.querySelector(".wpforms-field-address-state"),type:t?"long_name":"short_name"},postal_code:{el:o.querySelector(".wpforms-field-address-postal"),type:"long_name"},country:{el:t,type:"short_name"}}),l.push({searchField:e,mapField:a,type:n,additionalFields:i})})},initMap:function(e){var t,o;e.mapField&&(t=wpforms_geolocation_settings.default_location,o=wpforms_geolocation_settings.zoom,e.map=new google.maps.Map(e.mapField,{zoom:o,center:t}),e.marker=new google.maps.Marker({position:t,draggable:!0,map:e.map}),e.marker.addListener("dragend",s.markerDragend))},initGeocoder:function(){n=new google.maps.Geocoder},markerDragend:function(e){var t=s.findFieldPlaceByMarker(this);t&&(s.detectByCoordinates(t,e.latLng),t.map.setCenter(e.latLng))},detectByCoordinates:function(o,e){n&&n.geocode({location:e},function(e,t){return"OK"!==t?(s.showDebugMessage("Geocode was wrong"),void s.showDebugMessage(e)):void(e[0]&&s.updateFields(o,e[0]))})},updateMap:function(e,t){e.map&&(e.marker.setPosition(t),e.map.setCenter(t))},findFieldPlaceByMarker:function(t){var o=null;return l.forEach(function(e){e.marker===t&&(o=e)}),o},findFieldPlaceByAutocomplete:function(t){var o=null;return l.forEach(function(e){e.autocomplete===t&&(o=e)}),o},findFieldPlaceByCountry:function(t){var o=null;return l.forEach(function(e){e.additionalFields&&e.additionalFields.country&&e.additionalFields.country.el===t&&(o=e)}),o},findFieldPlaceByPolitical:function(t){var o=null;return l.forEach(function(e){e.additionalFields&&e.additionalFields.political&&e.additionalFields.political.el===t&&(o=e)}),o},initAutocomplete:function(e){e.autocomplete=new google.maps.places.Autocomplete(e.searchField,{types:["geocode"]}),e.autocomplete.addListener("place_changed",s.updateFieldPlace),"address"===e.type&&s.initAutocompleteAddress(e)},initAutocompleteAddress:function(e){if(s.disableBrowserAutocomplete(e.searchField),e.additionalFields.country.el)e.additionalFields.country.el.addEventListener("change",s.updateCountry);else if(e.autocomplete.setComponentRestrictions({country:["us"]}),e.additionalFields.political.el){const t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status)for(var e in o=JSON.parse(t.responseText))Object.prototype.hasOwnProperty.call(o,e)&&delete o[e].name},t.open("GET",wpforms_geolocation_settings.states),t.send(),e.additionalFields.political.el.addEventListener("change",s.updateArea)}},disableBrowserAutocomplete:function(e){var t;-1!==navigator.userAgent.indexOf("Chrome")&&(t=new MutationObserver(function(){t.disconnect(),e.setAttribute("autocomplete","chrome-off")})).observe(e,{attributes:!0,attributeFilter:["autocomplete"]})},updateFieldPlace:function(){var e,t=s.findFieldPlaceByAutocomplete(this);t&&t.autocomplete&&((e=t.autocomplete.getPlace()).geometry.location&&(s.updateMap(t,e.geometry.location),s.updateFields(t,e)))},updateFields:function(e,t){Object.prototype.hasOwnProperty.call(t,"formatted_address")&&("text"===e.type?s.updateTextField(e,t):"address"===e.type&&s.updateAddressField(e,t),s.triggerEvent(e.searchField,"change"),s.showDebugMessage("Fields was updated"),s.showDebugMessage(e),s.showDebugMessage(t))},updateTextField:function(e,t){e.searchField.value=t.formatted_address},triggerEvent:function(e,t){var o=a.createEvent("HTMLEvents");o.initEvent(t,!0,!0),e.dispatchEvent(o)},updateAddressField:function(e,t){for(var o="",a="",n=0;n<t.address_components.length;n++){var i=t.address_components[n].types[0];"route"!==i?"street_number"!==i?e.additionalFields[i]&&e.additionalFields[i].el&&(e.additionalFields[i].el.value=t.address_components[n][e.additionalFields[i].type]):a=t.address_components[n].short_name:o=t.address_components[n].short_name}e.searchField.value=s.formatAddressField(t,a,o)},formatAddressField:function(e,t,o){return(0===e.formatted_address.indexOf(t)?t+" "+o:o+", "+t).trim().replace(/,$|^,/g,"")},updateCountry:function(){var e=s.findFieldPlaceByCountry(this),t=this.value.toString().toLocaleLowerCase();e&&e.autocomplete&&(e.autocomplete.setComponentRestrictions({country:[t]}),s.showDebugMessage("Autocomplete field restrict to country: "+t))},updateArea:function(){var e=s.findFieldPlaceByPolitical(this),t=this.value.toString().toUpperCase();e&&e.autocomplete&&o[t]&&(e.autocomplete.setBounds(new google.maps.LatLngBounds(o[t])),s.showDebugMessage("Autocomplete field restrict to state: "+t))},detectGeolocation:function(){var t;wpforms_geolocation_settings.current_location&&navigator.geolocation&&l&&(t={},navigator.geolocation.getCurrentPosition(function(e){t={lat:e.coords.latitude,lng:e.coords.longitude},l.forEach(function(e){s.updateMap(e,t),s.detectByCoordinates(e,t)})}))}};return s}(document,window);function WPFormsGeolocationInitGooglePlacesAPI(){window.removeEventListener("load",WPFormsGeolocationGooglePlacesAPI.init),WPFormsGeolocationGooglePlacesAPI.init()}window.addEventListener("load",WPFormsGeolocationGooglePlacesAPI.init);